<!doctype html>
<html>
  <head>
    <title>{{ title }}</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="{{ favicon_url }}" />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      }
      #app {
        height: 100vh;
      }
      
      /* Hide unwanted UI elements immediately */
      .cookies-section, 
      [data-testid="cookies-container"],
      .scalar-cookies-container,
      .scalar-query-parameters-container,
      .custom-headers-container,
      div[data-accordion-id*="cookies"],
      div[data-testid*="query-parameters"] {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <!-- Load Scalar API Reference script -->
    <script src="{{ scalar_js_url }}"></script>

    <!-- Initialize Scalar API Reference -->
    <script>
      // Initialize Scalar with basic options
      const scalarInstance = Scalar.createApiReference('#app', {
        spec: {
          url: '{{ openapi_url }}'
        },
        theme: {
          colors: {
            primary: {
              main: '#2563eb'
            }
          }
        },
        layout: {
          showSidebar: true
        }
      });
      
      // Function to apply aggressive DOM modifications
      function customizeScalarUI() {
        // Give the UI time to render
        setTimeout(() => {
          console.log("Customizing Scalar UI...");
          
          // Function to find and remove unwanted sections
          function removeUnwantedSections() {
            // Selectors for sections we want to hide
            const selectorsList = [
              // Cookies related selectors
              '.cookies-section', '[data-testid="cookies-container"]', 
              '.scalar-cookies-container', 'div[data-accordion-id*="cookies"]',
              
              // Query Parameters selectors
              '.scalar-query-parameters-container', 'div[data-testid*="query-parameters"]',
              'div[data-accordion-id*="query"]',
              
              // Additional Headers (except auth)
              '.custom-headers-container', '.http-headers-container',
              
              // Remove Add button for headers/cookies/etc
              'button:has(span:contains("Add"))', '[data-testid*="add-row-button"]'
            ];
            
            // Try each selector
            selectorsList.forEach(selector => {
              try {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                  el.style.display = 'none';
                  console.log(`Hiding element with selector: ${selector}`);
                });
              } catch (e) {
                console.log(`Error with selector ${selector}:`, e);
              }
            });
            
            // Force JSON body editors to use form mode
            try {
              const jsonEditors = document.querySelectorAll('.json-editor, .scalar-json-editor');
              jsonEditors.forEach(editor => {
                // Add a custom attribute to identify
                editor.setAttribute('data-force-form', 'true');
                
                // Look for parent container 
                const parentContainer = editor.closest('.request-body-container, [data-testid*="body"]');
                if (parentContainer) {
                  // Find the "Raw" button and click the "Form" button if it exists
                  const buttons = parentContainer.querySelectorAll('button');
                  buttons.forEach(button => {
                    if (button.innerText.includes('Form')) {
                      button.click();
                      console.log('Forcing Form mode for body editor');
                    }
                  });
                }
              });
            } catch (e) {
              console.log('Error forcing form mode:', e);
            }
          }
          
          // Initial removal
          removeUnwantedSections();
          
          // Set up a mutation observer to catch new elements as they're added
          const observer = new MutationObserver((mutations) => {
            removeUnwantedSections();
          });
          
          // Start observing the body for DOM changes
          observer.observe(document.body, { 
            childList: true, 
            subtree: true 
          });
          
          // Add custom CSS for more control
          const style = document.createElement('style');
          style.textContent = `
            /* Hide cookies section */
            [data-testid*="cookies"], [data-accordion-id*="cookies"], 
            .scalar-cookies-container, .cookies-section {
              display: none !important;
            }
            
            /* Hide query parameters section */
            [data-testid*="query-parameters"], [data-accordion-id*="query"],
            .scalar-query-parameters-container {
              display: none !important;
            }
            
            /* Hide custom headers section (except auth) */
            .http-headers-container:not(:has(.authorization-container)),
            .custom-headers-container {
              display: none !important;
            }
            
            /* Hide Raw option, enforce Form mode */
            button:has(span:contains("Raw")) {
              display: none !important;
            }
            
            /* Force body inputs to show as forms */
            [data-testid*="body"] .CodeMirror, 
            [data-testid*="body"] .monaco-editor {
              display: none !important;
            }
            
            /* Hide any Add buttons */
            button:has(span:contains("Add")) {
              display: none !important;
            }
          `;
          document.head.appendChild(style);
          
          console.log("Scalar UI customization complete");
        }, 1000);
      }
      
      // Run customization when document is loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', customizeScalarUI);
      } else {
        customizeScalarUI();
      }
    </script>
  </body>
</html> 